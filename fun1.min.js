$(function(){$.get("example.txt",function(e){$("#original").val(e)}),$.get("fiber.tsv",function(e){$("#fiberMap").val(e)}),$.get("material.tsv",function(e){$("#matMap").val(e)}),$("#clearTxt").click(function(){$("#original").val("")}),$("#copy").click(function(){var e,a,n=document.getElementById("result");document.createRange?((e=document.createRange()).selectNode(n),(a=window.getSelection()).removeAllRanges(),a.addRange(e),document.execCommand("copy"),a.removeAllRanges()):((e=document.body.createTextRange()).moveToElementText(n),e.select(),document.execCommand("copy")),alert("Translation is copied to clipboard")}),$("#run").click(function(){var e={},a={},n={},t=$("#fiberMap").val();$(t.split("\n")).each(function(a,t){var s=t.split(/\t|:\s*/);e[s[0]]&&(n["Duplicate fiber mapping: "+s[0]]=1),s[0]&&(e[s[0]]=s[1])});var s=$("#matMap").val(),r=[],i="",l={};$(s.split("\n")).each(function(e,t){var s=t.split(/\t|:\s*/);a[s[0].toUpperCase()]&&(n["Duplicate material mapping: "+s[0]]=1),s[0]&&(a[s[0].toUpperCase()]=s[1],s[1]!==i&&r.push(s[1]),i=s[1])}),$(".error").html("").hide();var o=$("#original").val().split("\n"),c="",p=/(\d\.)?([^\d]*?)( \d)?$/;$(o).each(function(t,s){var i=s.split(/\s*;\s*/),o=[],u={};$(i).each(function(t,s){var i,c=s.split(":"),d=c[0],h=c[0];d.length>0&&null!==(i=p.exec(c[0]))&&(i.index===p.lastIndex&&p.lastIndex++,a[i[2].toUpperCase()]?(d=(i[1]||"")+a[i[2].toUpperCase()]+(i[3]||""),h=a[i[2].toUpperCase()]):(d="<span class='red'>"+c[0]+"</span>",n["Material map missing: "+i[2]]=1,l[i[2]]||(r.push(i[2]),l[i[2]]=1))),u[h]||(u[h]=[]);for(var $=[],g=/((\d+)%) ([A-Z]+)/gm,v=0;null!==(m=g.exec(c[1]));)m.index===g.lastIndex&&g.lastIndex++,v+=parseInt(m[2]),e[m[3]]?(m[3]=e[m[3]],"100%"===m[1]&&-1!==m[3].search("Èù©")&&(m[1]="")):(n["Fiber map missing: "+m[3]]=1,m[3]="<span class='red'>"+m[3]+"</span>"),$.push((m[1]?m[1]:"")+m[3]);d.length>0?(100!==v&&0!==v&&($.push("<span class='blue'>[Error: total is "+v+"%]</span>"),n["Total % is not equal to 100%."]=1),u[h].push($),d+=":"+$.join(" ")):d="",o.push(d)});var d=[];$.each(r,function(e,a){if(u[a]){var n=1,t=u[a].length>1?1:0;$.each(u[a],function(e,s){s.length>1&&(s=s.sort(function(e,a){return parseInt(a)-parseInt(e)}));var r=s.join(" ");d.push((l[a]?'<span class="red">'+a+"</span>":a)+(t?n:"")+": "+r),a,r,n++})}}),c+=d.join("; ")+"\n"}),$("#result").html(c).show(),$("#copy,#transtitle").show(),Object.keys(n).length&&($(".error").append("<h3>Error</h3>").show(),$.each(n,function(e,a){$(".error").append('<div class="red">'+e+"</div>")})),$("#original").height($("#result").height())})});
